# See https://docs.docker.com/compose/compose-file/
version: '3'

services:
  plaza-router:
    build: utils/router
    ports:
      - 8080:80
    links:
      - plaza-frontend
      - plaza-backend
    environment:
      - FRONTEND_NODE=plaza-frontend
      - FRONTEND_PORT=80
      - BACKEND_NODE=plaza-backend
      - BACKEND_PORT=8888

  plaza-frontend:
    build: frontend

  plaza-backend:
    build: backend
    command:
      - _build/default/rel/automate/bin/automate
      - foreground
      - '-mnesia'
      - dir
      - '"/app/Mnesia.dev"'
      - '-mnesia'
      - dump_log_time_threshold
      - '1000'
      # Save entries every second, comment this for performance testing
    volumes:
      - plaza-dev-backend-mnesia:/app/Mnesia.dev

volumes:
  plaza-dev-backend-mnesia:

